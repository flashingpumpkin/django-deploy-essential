upstream application {
    server <%= node[:application][:ip] %>:<%= node[:application][:port] %> fail_timeout=0;
}

server {
    listen <%= node[:nginx][:port] %>;
    #listen [::]:<%= node[:nginx][:port] %>;

    root <%= node[:nginx][:root] %>;
    index index.html index.htm;

    server_name <%= node[:nginx][:hostname] %>;

    location / {
          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
          proxy_set_header Host $http_host;
          proxy_redirect off;
          
          if (!-f $request_filename) {
              proxy_pass http://application;
              break;
          }
    }
}
